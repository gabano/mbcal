<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maple Bear - Agenda Middle Years</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --mb-blue: #004a99; --mb-red: #e30613; }
        .day-card { background: white; border-radius: 24px; border-left: 10px solid var(--mb-blue); margin-bottom: 2rem; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1); }
        .status-confirmada { border-left-color: #22c55e; background: #f0fdf4; }
        .status-noshow { border-left-color: #4b5563; background: #f3f4f6; }
        .status-cancelada { border-left-color: #ef4444; background: #fef2f2; }
        .status-aconfirmar { border-left-color: #3b82f6; background: #eff6ff; }
        .room-bar { height: 12px; background: #f1f5f9; border-radius: 6px; position: relative; min-width: 500px; }
        .busy-now { position: absolute; height: 100%; background: var(--mb-red); border-radius: 4px; }
    </style>
</head>
<body class="bg-slate-50 p-4 pb-32">

    <div class="max-w-2xl mx-auto bg-white p-6 rounded-[32px] shadow-sm mb-10 border border-slate-100">
        <h2 class="text-[10px] font-black uppercase text-slate-400 mb-4 tracking-[0.2em]">Ocupação das Salas (Hoje)</h2>
        <div class="overflow-x-auto">
            <div class="flex ml-20 mb-2">
                <script>for(let i=7;i<=18;i++) document.write(`<span class="min-w-[40px] text-[10px] text-slate-300 font-bold">${i}h</span>`)</script>
            </div>
            <div class="space-y-4">
                <div class="flex items-center gap-4"><span class="text-[10px] font-black w-16 text-slate-500">REUNIÃO</span><div class="room-bar flex-1" id="bar-Sala de Reunião"></div></div>
                <div class="flex items-center gap-4"><span class="text-[10px] font-black w-16 text-slate-500">DIREÇÃO</span><div class="room-bar flex-1" id="bar-Sala da Direção"></div></div>
                <div class="flex items-center gap-4"><span class="text-[10px] font-black w-16 text-slate-500">AULA</span><div class="room-bar flex-1" id="bar-Sala de aula"></div></div>
            </div>
        </div>
    </div>

    <div id="agenda-feed" class="max-w-2xl mx-auto space-y-6"></div>

    <button onclick="document.getElementById('createModal').classList.remove('hidden')" class="fixed bottom-8 right-8 bg-blue-900 text-white w-16 h-16 rounded-full shadow-2xl text-4xl flex items-center justify-center z-50">＋</button>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyKibpEVNrijSTIMGY26KT34kGUmhzp4oghGyuedNSJ1K7k3G1CdQ1SEYN-8CPLBxTt/exec';

        async function load() {
            const feed = document.getElementById('agenda-feed');
            try {
                const res = await fetch(SCRIPT_URL);
                const events = await res.json();
                
                // Gerar próximos 30 dias úteis
                const today = new Date();
                feed.innerHTML = '';

                for(let i = 0; i < 40; i++) {
                    const d = new Date();
                    d.setDate(today.getDate() + i);
                    if(d.getDay() === 0 || d.getDay() === 6) continue; // Pula fins de semana

                    const dateStr = d.toISOString().split('T')[0];
                    const displayDate = d.toLocaleDateString('pt-BR', { day:'2-digit', month:'long', year:'numeric'});
                    const weekDay = d.toLocaleDateString('pt-BR', { weekday: 'long' }).toUpperCase();

                    const dayCard = document.createElement('div');
                    dayCard.className = 'day-card p-6';
                    dayCard.innerHTML = `
                        <div class="mb-6 border-b border-slate-50 pb-2">
                            <h3 class="text-xl font-black text-blue-900">${weekDay}</h3>
                            <p class="text-[10px] font-bold text-slate-400 tracking-widest">${displayDate}</p>
                        </div>
                    `;

                    const dayEvents = events.filter(e => e.start.startsWith(dateStr));
                    if(dayEvents.length === 0) {
                        dayCard.innerHTML += `<p class="text-slate-200 text-[10px] font-bold uppercase py-4">Sala Disponível</p>`;
                    } else {
                        dayEvents.sort((a,b) => a.start.localeCompare(b.start)).forEach(e => {
                            const time = new Date(e.start).toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
                            const cardStyle = `status-${e.status.toLowerCase().replace(" ", "")}`;
                            dayCard.innerHTML += `
                                <div onclick="handleEventClick('${e.id}')" class="p-4 mb-3 rounded-2xl cursor-pointer shadow-sm transition-all hover:scale-[1.02] ${cardStyle}">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="font-black text-lg">${time}</span>
                                        <span class="text-[8px] font-black uppercase opacity-40">${e.status}</span>
                                    </div>
                                    <div class="text-sm font-bold text-slate-700">${e.title}</div>
                                </div>
                            `;
                        });
                    }
                    feed.appendChild(dayCard);
                }
                updateRoomVisuals(events);
            } catch(e) {
                feed.innerHTML = `<p class="text-red-500">Erro de conexão com Google Script.</p>`;
            }
        }

        // ... Mantenha as funções handleEventClick, updateStatus, deleteEvent e scheduleForm.onsubmit ...
        load();
    </script>
</body>
</html>
