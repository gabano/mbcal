<script>
async function manageEventStatus(eventId) {
    const pwd = prompt("Senha:");
    if (pwd !== "cancelar123") return;

    // A nicer way to ask for status
    const menu = "Escolha o Status:\n1. Confirmada (Verde)\n2. No Show (Preto)\n3. Cancelada (Vermelho)";
    const choice = prompt(menu);
    
    const statusMap = { "1": "Confirmada", "2": "No show", "3": "Cancelada" };
    const newStatus = statusMap[choice];
    
    if (!newStatus) return;

    const res = await fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'updateStatus', eventId: eventId, newStatus: newStatus })
    });
    
    const result = await res.json();
    if (result.success) {
        alert("Status Atualizado!");
        location.reload();
    }
}

function renderContainers(events) {
    const wrapper = document.getElementById('days-wrapper');
    const weekdays = ['Segunda', 'TerÃ§a', 'Quarta', 'Quinta', 'Sexta'];
    wrapper.innerHTML = '';

    weekdays.forEach((day, index) => {
        const container = document.createElement('div');
        container.className = 'day-container p-4 mb-4 bg-white rounded-xl shadow';
        
        // Get events for this weekday (Mon=1, Tue=2...)
        const dayEvents = events.filter(e => new Date(e.start).getDay() === index + 1);
        
        container.innerHTML = `<h3 class="font-black text-blue-900 border-b mb-3">${day.toUpperCase()}</h3>`;
        
        if (dayEvents.length === 0) {
            container.innerHTML += `<div class="text-gray-300 text-xs py-2">Sem agendamentos</div>`;
        } else {
            dayEvents.sort((a,b) => new Date(a.start) - new Date(b.start)).forEach(e => {
                const time = new Date(e.start).toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
                const segmento = e.description?.split('\n')[0] || "---";
                
                const slot = document.createElement('div');
                slot.className = "p-3 mb-2 bg-slate-50 border-l-4 border-blue-500 rounded-r shadow-sm cursor-pointer hover:bg-blue-50";
                slot.innerHTML = `
                    <div class="flex justify-between">
                        <span class="font-bold text-blue-900">${time}</span>
                        <span class="text-[10px] font-mono text-gray-400">ID: ...${e.id.slice(-5)}</span>
                    </div>
                    <div class="text-sm font-bold text-gray-700">OCUPADO (${segmento})</div>
                `;
                slot.onclick = () => manageEventStatus(e.id);
                container.appendChild(slot);
            });
        }
        wrapper.appendChild(container);
    });
}
</script>
