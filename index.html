<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda Middle Years - Maple Bear</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <style>
        :root { --mb-blue: #004a99; --mb-red: #e30613; }
        
        /* Remove weekends and adjust grid */
        .fc-day-sat, .fc-day-sun { display: none !important; }
        
        /* Custom Scrollable Day Containers */
        .fc-scroller { overflow-y: auto !important; height: auto !important; max-height: 60vh; }
        .fc-timegrid-slot { height: 50px !important; } /* Taller slots for easier clicking */

        /* Room Timeline Styling */
        .timeline-wrapper { overflow-x: auto; white-space: nowrap; background: #fff; padding: 15px; border-radius: 12px; }
        .time-axis { display: flex; margin-left: 100px; border-bottom: 1px solid #eee; }
        .time-tick { min-width: 50px; font-size: 10px; color: #999; }
        .room-row { display: flex; align-items: center; margin-top: 10px; }
        .room-label { min-width: 100px; font-weight: bold; font-size: 11px; color: var(--mb-blue); }
        .room-bar { flex-grow: 1; height: 20px; background: #f0fdf4; border-radius: 10px; position: relative; min-width: 560px; border: 1px solid #dcfce7; }
        .busy-block { position: absolute; height: 100%; background: #fee2e2; border-left: 4px solid var(--mb-red); font-size: 9px; color: #b91c1c; display: flex; align-items: center; padding-left: 5px; }
    </style>
</head>
<body class="bg-gray-50 pb-24">

    <div class="p-4 bg-white shadow-sm mb-4 border-b-2 border-blue-900">
        <h2 class="text-xs font-black uppercase mb-3 text-gray-500 tracking-tighter">Ocupação das Salas (Hoje)</h2>
        <div class="timeline-wrapper">
            <div class="time-axis" id="timeAxis"></div>
            <div id="room-bars">
                <div class="room-row"><span class="room-label">Reunião</span><div class="room-bar" id="bar-Sala de Reunião"></div></div>
                <div class="room-row"><span class="room-label">Direção</span><div class="room-bar" id="bar-Sala da Direção"></div></div>
                <div class="room-row"><span class="room-label">Aula</span><div class="room-bar" id="bar-Sala de aula"></div></div>
            </div>
        </div>
    </div>

    <div id="calendar" class="bg-white p-2 shadow-sm rounded-lg mx-2"></div>

    <div class="fixed bottom-6 right-6 flex flex-col gap-3 z-50">
        <button onclick="requestCancel()" class="bg-gray-800 text-white px-4 py-2 rounded-full shadow-lg text-xs font-bold uppercase tracking-widest">Cancelar</button>
        <button onclick="toggleModal(true)" class="bg-red-600 text-white w-16 h-16 rounded-full shadow-2xl text-3xl font-bold flex items-center justify-center">＋</button>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw2lrYJmIYnkIeLYbr6xuQmQXrG4bCpjIGU49sOENWqXVJHgA6Bj54h61BX-AISpIej/exec';
        let calendar;

        function updateRoomVisuals(events) {
            const today = new Date().toISOString().split('T')[0];
            const startDay = 7; 
            const totalHours = 11.33; 
            
            ['Sala de Reunião', 'Sala da Direção', 'Sala de aula'].forEach(room => {
                const bar = document.getElementById(`bar-${room}`);
                if(!bar) return;
                bar.innerHTML = '';
                events.filter(e => e.start.startsWith(today) && e.location === room).forEach(e => {
                    const s = new Date(e.start);
                    const eTime = new Date(e.end);
                    const left = ((s.getHours() + s.getMinutes()/60) - startDay) / totalHours * 100;
                    const width = (eTime - s) / (totalHours * 3600000) * 100;
                    bar.innerHTML += `<div class="busy-block" style="left:${left}%; width:${width}%">BUSY</div>`;
                });
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const axis = document.getElementById('timeAxis');
            for(let h=7; h<=18; h++) axis.innerHTML += `<div class="time-tick">${h}:00</div>`;

            calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
                initialView: 'timeGridWeek',
                weekends: false, // Hides Saturday and Sunday
                slotMinTime: '07:00:00',
                slotMaxTime: '18:20:00',
                locale: 'pt-br',
                allDaySlot: false,
                height: 'auto',
                handleWindowResize: true,
                expandRows: true,
                headerToolbar: { left: 'prev,next', center: 'title', right: '' },
                events: function(info, success) {
                    fetch(SCRIPT_URL).then(r => r.json()).then(data => {
                        updateRoomVisuals(data);
                        // PUBLIC VIEW: Only show Busy Blocks
                        success(data.map(e => ({
                            title: 'OCUPADO',
                            start: e.start,
                            end: e.end,
                            color: '#94a3b8'
                        })));
                    });
                }
            });
            calendar.render();
            updateTurmas();
        });

        // Hashing and Form logic same as before...
    </script>
</body>
</html>
